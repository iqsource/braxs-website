---
import Button from './ui/Button.astro';
import { getTranslations, type Language } from '../i18n/translations';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const t = getTranslations(lang);
const otherLang = lang === 'es' ? 'en' : 'es';
---

<header class="nav" id="navbar">
  <div class="nav__container">
    <a href={`/${lang}/`} class="nav__logo-link" aria-label="Braxs Global Home">
      <img
        src="/images/braxs-logo.png"
        alt="Braxs Global"
        class="nav__logo"
        width="160"
        height="50"
      />
    </a>

    <nav class="nav__menu" aria-label="Main navigation">
      <ul class="nav__links" id="nav-links">
        <li><a href={`/${lang}/#benefits`} class="nav__link">{t.nav.benefits}</a></li>
        <li><a href={`/${lang}/#services`} class="nav__link">{t.nav.services}</a></li>
        <li><a href={`/${lang}/#security`} class="nav__link">{t.nav.security}</a></li>
        <li><a href={`/${lang}/#how-it-works`} class="nav__link">{t.nav.howItWorks}</a></li>
        <li><a href={`/${lang}/#faq`} class="nav__link">{t.nav.faq}</a></li>
      </ul>
    </nav>

    <div class="nav__actions">
      <!-- Language Switcher -->
      <div class="lang-switcher" role="group" aria-label="Language selection">
        <a
          href={`/en/`}
          class:list={['lang-option', { active: lang === 'en' }]}
          aria-current={lang === 'en' ? 'page' : undefined}
        >
          EN
        </a>
        <a
          href={`/es/`}
          class:list={['lang-option', { active: lang === 'es' }]}
          aria-current={lang === 'es' ? 'page' : undefined}
        >
          ES
        </a>
        <div class="lang-indicator" data-lang={lang}></div>
      </div>

      <Button href="#download-app" variant="primary" size="sm">
        {t.nav.downloadApp}
      </Button>

      <!-- Mobile Menu Toggle -->
      <button
        class="nav__mobile-toggle"
        id="mobile-toggle"
        aria-expanded="false"
        aria-controls="nav-links"
        aria-label="Toggle menu"
      >
        <span class="hamburger" aria-hidden="true">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
    </div>
  </div>
</header>

<script>
  // Navigation scroll effect
  const navbar = document.getElementById('navbar');
  let lastScroll = 0;

  window.addEventListener('scroll', () => {
    const currentScroll = window.scrollY;

    if (currentScroll > 50) {
      navbar?.classList.add('nav--solid');
    } else {
      navbar?.classList.remove('nav--solid');
    }

    lastScroll = currentScroll;
  });

  // Mobile menu toggle
  const mobileToggle = document.getElementById('mobile-toggle');
  const navLinks = document.getElementById('nav-links');
  const hamburger = mobileToggle?.querySelector('.hamburger');

  mobileToggle?.addEventListener('click', () => {
    const isOpen = navLinks?.classList.toggle('is-open');
    hamburger?.classList.toggle('is-active');
    mobileToggle.setAttribute('aria-expanded', String(isOpen));
  });

  // Close mobile menu on link click
  navLinks?.querySelectorAll('.nav__link').forEach(link => {
    link.addEventListener('click', () => {
      navLinks.classList.remove('is-open');
      hamburger?.classList.remove('is-active');
      mobileToggle?.setAttribute('aria-expanded', 'false');
    });
  });
</script>

<style>
  .nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: var(--z-sticky);
    padding: var(--space-4) var(--space-6);
    transition: all var(--duration-normal) var(--ease-smooth);
    background: transparent;
  }

  .nav--solid {
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    padding: var(--space-3) var(--space-6);
  }

  .nav__container {
    max-width: var(--container-xl);
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-8);
  }

  .nav__logo-link {
    flex-shrink: 0;
  }

  .nav__logo {
    height: 45px;
    width: auto;
    transition: opacity var(--duration-fast) var(--ease-smooth);
  }

  .nav__logo:hover {
    opacity: 0.9;
  }

  .nav__menu {
    flex: 1;
    display: flex;
    justify-content: center;
  }

  .nav__links {
    display: flex;
    gap: var(--space-8);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav__link {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--text-secondary);
    text-decoration: none;
    padding: var(--space-2) 0;
    position: relative;
    transition: color var(--duration-fast) var(--ease-smooth);
  }

  .nav__link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--gradient-gold);
    transition: width var(--duration-normal) var(--ease-smooth);
  }

  .nav__link:hover {
    color: var(--text-primary);
  }

  .nav__link:hover::after {
    width: 100%;
  }

  .nav__actions {
    display: flex;
    align-items: center;
    gap: var(--space-4);
  }

  /* Language Switcher */
  .lang-switcher {
    position: relative;
    display: flex;
    background: var(--dark-800);
    border-radius: var(--radius-full);
    padding: 3px;
  }

  .lang-option {
    position: relative;
    z-index: 1;
    padding: var(--space-1) var(--space-3);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    color: var(--text-muted);
    text-decoration: none;
    border-radius: var(--radius-full);
    transition: color var(--duration-fast) var(--ease-smooth);
  }

  .lang-option.active {
    color: var(--dark-900);
  }

  .lang-option:hover:not(.active) {
    color: var(--text-secondary);
  }

  .lang-indicator {
    position: absolute;
    top: 3px;
    left: 3px;
    width: calc(50% - 3px);
    height: calc(100% - 6px);
    background: var(--gradient-gold);
    border-radius: var(--radius-full);
    transition: transform var(--duration-normal) var(--ease-spring);
  }

  .lang-indicator[data-lang="en"] {
    transform: translateX(0);
  }

  .lang-indicator[data-lang="es"] {
    transform: translateX(100%);
  }

  /* Mobile Menu Toggle */
  .nav__mobile-toggle {
    display: none;
    width: 44px;
    height: 44px;
    padding: var(--space-2);
    background: transparent;
    border: none;
    cursor: pointer;
    align-items: center;
    justify-content: center;
  }

  .hamburger {
    width: 24px;
    height: 20px;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .hamburger span {
    display: block;
    width: 100%;
    height: 2px;
    background: var(--text-primary);
    border-radius: 2px;
    transition: all var(--duration-normal) var(--ease-smooth);
  }

  .hamburger.is-active span:nth-child(1) {
    transform: translateY(9px) rotate(45deg);
  }

  .hamburger.is-active span:nth-child(2) {
    opacity: 0;
    transform: translateX(-10px);
  }

  .hamburger.is-active span:nth-child(3) {
    transform: translateY(-9px) rotate(-45deg);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .nav__links {
      gap: var(--space-6);
    }
  }

  @media (max-width: 768px) {
    .nav__menu {
      display: none;
    }

    .nav__links {
      position: fixed;
      top: 0;
      right: 0;
      width: 80%;
      max-width: 320px;
      height: 100vh;
      flex-direction: column;
      background: var(--dark-900);
      padding: var(--space-20) var(--space-8);
      gap: var(--space-4);
      transform: translateX(100%);
      transition: transform var(--duration-slow) var(--ease-smooth);
      box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
      display: flex;
    }

    .nav__links.is-open {
      transform: translateX(0);
    }

    .nav__mobile-toggle {
      display: flex;
    }

    .nav__actions .btn {
      display: none;
    }

    .nav__link {
      font-size: var(--text-lg);
      padding: var(--space-3) 0;
    }
  }
</style>
